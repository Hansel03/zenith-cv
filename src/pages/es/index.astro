---
import { getEntry } from 'astro:content';
import { es } from 'date-fns/locale';

import CvContent from '@/web/components/cv-content.astro';
import { initializeWebContext } from '@/web/utils/initialize-web-context';

await initializeWebContext(Astro, {
  locale: es,
  translations: getEntry('translations', 'es'),
  dateFormat: 'MMMM yyyy',
  theme: 'custom',
  pdf: {
    path: '/generated/pdf/es.pdf',
    label: 'Descargar CV',
    filename: 'hansel-suarez-cv.pdf',
  },
});

const basicsEntry = await getEntry('basics', 'main-es');
const metadataEntry = await getEntry('metadata', 'main');

if (!basicsEntry) throw new Error('Basics entry not found');
if (!metadataEntry) throw new Error('Metadata entry not found');
---

<script is:inline>
  if (typeof localStorage !== 'undefined') {
    const saved = localStorage.getItem('lang');
    if (saved === 'en') {
      window.location.href = '/';
    }
  }
</script>

<CvContent basicsEntry={basicsEntry} metadataEntry={metadataEntry} />
